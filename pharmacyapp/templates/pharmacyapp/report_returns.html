{% extends 'pharmacyapp/base.html' %}

{% block body_block %}
<div class="row">
    <!-- Sidebar -->
    <div class="col-md-4">
        <form method="POST" class="report-form">
            {% csrf_token %}
            <h3>Quick Return Report</h3>
            <div class="mb-3">
                <button type="submit" class="btn btn-primary" name="Today" value="Today">Today's Return</button>
                <button type="submit" class="btn btn-primary" name="Yesterday" value="Yesterday">Yesterday's Return</button>
            </div>

            <hr />

            <h3>Time Frame Return Report</h3>

            <!-- Start Date Field -->
            <div class="mb-3">
                {{ form.startDate.label_tag }}
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
                    {{ form.startDate }}
                </div>
            </div>

            <!-- End Date Field -->
            <div class="mb-3">
                {{ form.endDate.label_tag }}
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
                    {{ form.endDate }}
                </div>
            </div>

			<!-- Inside the form section -->
			<div class="mb-3">
				<label for="{{ form.medicineName.id_for_label }}">Medicine</label>
				<select name="{{ form.medicineName.html_name }}" id="{{ form.medicineName.id_for_label }}" class="form-select">
					<option value="">{{ form.medicineName.empty_label }}</option>
					{% for med in form.fields.medicineName.queryset %}
					<option value="{{ med.id }}" {% if form.medicineName.value|stringformat:"s" == med.id|stringformat:"s" %}selected{% endif %}>{{ med.medicineName }}</option>
					{% endfor %}
				</select>
			</div>

            <button type="submit" class="btn btn-primary" name="custom" value="custom">Search</button>
        </form>

        {% if messages %}
        <ul class="messages mt-3">
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
        {% endif %}
    </div>

    <!-- Main Report Table -->
    <div class="col-md-8">
        <div id="printarea">
            <table class="table table-striped" id="daysales">
                <caption><h1>Return Report</h1></caption>
                <thead>
                    <tr>
                        <th>Bill Number</th>
                        <th>Purchase Date</th>
                        <th>Return Date</th>
                        <th>Product Name</th>
                        <th>Batch Number</th>
                        <th>Units Ordered</th>
                        <th>Units Returned</th>
                        <th>Refund</th>
                    </tr>
                </thead>
                <tbody>
                    {% if reports %}
                        {% for report in reports %}
                        <tr>
                            <td>{{ report.billNo }}</td>
                            <td>{{ report.billDate }}</td>
                            <td>{{ report.returnSalesBillDate }}</td>
                            <td>{{ report.medStock.medicine.medicineName }}</td>
                            <td>{{ report.medStock.batchNo }}</td>
                            <td>{{ report.noOfTabletsOrdered }}</td>
                            <td>{{ report.returnSalesNoOfTablets }}</td>
                            <td>{{ report.returnDiscountedPrice }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="8" class="text-center">No records found.</td>
                        </tr>
                    {% endif %}
                    <tr>
                        <th>Total Refunds</th>
                        <th></th><th></th><th></th><th></th><th></th><th></th><th id="TPP"></th>
                    </tr>
                </tbody>
            </table>
        </div>

        {% if user.is_authenticated %}
        <button type="button" class="btn btn-primary" onclick="printDiv('printarea')">Print</button>
        {% endif %}
    </div>
</div>

{% if reports %}
<body onload="finishTable_v1(7);">
    <script type="text/javascript" src="/static/js/jscript-queries.js"></script>
</body>
{% endif %}
{% endblock %}
